<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Idea Creator</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <style>
        :root { --bg: #f3f4f6; --card: #ffffff; --primary: #8b5cf6; --text: #1f2937; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; padding: 2rem; }
        .card { background: var(--card); padding: 2rem; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); width: 100%; max-width: 600px; margin-bottom: 2rem; }
        h1 { margin-top: 0; color: var(--primary); }
        input, button { width: 100%; padding: 0.8rem; margin-top: 1rem; border-radius: 0.5rem; border: 1px solid #d1d5db; font-size: 1rem; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        button:hover { opacity: 0.9; }
        #output, #historyWrapper { margin-top: 1.5rem; padding: 1rem; background: #eef2ff; border-radius: 0.5rem; }
        #output, #historyWrapper { display: none; }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–µ–π */
        .history-controls { display: flex; gap: 10px; }
        #hideTopicsBtn { background: #6b7280; display: none; } /* –°–µ—Ä—ã–π —Ü–≤–µ—Ç –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–∫—Ä—ã—Ç–∏—è */
        .idea-item, .topic-item { margin-bottom: 0.5rem; padding-left: 1.2rem; position: relative; }
        .idea-item::before, .topic-item::before { content: "‚Ä¢"; position: absolute; left: 0; color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>
    <div class="card">
        <h1>üí° Idea Creator</h1>
        <p>–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É, –∏ Idea Creator –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –∏–¥–µ–∏.</p>
        
        <input type="text" id="topicInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –∫–æ—Ñ–µ–π–Ω–∏">
        <input type="number" id="countInput" value="3" min="1" max="10">
        <button id="sendBtn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–¥–µ–∏</button>

        <div id="output">
            <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong>
            <div id="ideasContent" style="margin-top: 0.5rem;"></div>
        </div>
    </div>

    <div class="card">
        <h2>üìú –ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π</h2>
        <div class="history-controls">
            <button id="loadTopicsBtn">–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–µ–º</button>
            <button id="hideTopicsBtn">–°–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫</button>
        </div>
        
        <div id="historyWrapper">
            <div id="topicsList"></div>
        </div>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        const btn = document.getElementById('sendBtn');
        const output = document.getElementById('output');
        const ideasContent = document.getElementById('ideasContent');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏—Å—Ç–æ—Ä–∏–∏
        const loadTopicsBtn = document.getElementById('loadTopicsBtn');
        const hideTopicsBtn = document.getElementById('hideTopicsBtn');
        const historyWrapper = document.getElementById('historyWrapper');
        const topicsList = document.getElementById('topicsList');

        // –õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–¥–µ–π
        btn.onclick = async () => {
            const topic = document.getElementById('topicInput').value;
            const count = document.getElementById('countInput').value;
            if (!topic) return alert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É!");

            btn.disabled = true;
            btn.innerText = "Idea Creator –¥—É–º–∞–µ—Ç...";
            output.style.display = "none";

            try {
                const response = await fetch('/brainstorm', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title: topic, count: parseInt(count) })
                });
                const data = await response.json();
                
                ideasContent.innerHTML = "";
                const ideas = data.ideas || data; 
                ideas.forEach(text => {
                    const div = document.createElement('div');
                    div.className = 'idea-item';
                    div.innerText = text;
                    ideasContent.appendChild(div);
                });
                output.style.display = "block";
            } catch (err) {
                alert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
            } finally {
                btn.disabled = false;
                btn.innerText = "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–¥–µ–∏";
            }
        };

        // –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞
        loadTopicsBtn.onclick = async () => {
            loadTopicsBtn.innerText = "–ó–∞–≥—Ä—É–∑–∫–∞...";
            try {
                const response = await fetch('/topics');
                const topics = await response.json();
                
                topicsList.innerHTML = "";
                if (topics.length === 0) {
                    topicsList.innerText = "–°–ø–∏—Å–æ–∫ –ø–æ–∫–∞ –ø—É—Å—Ç.";
                } else {
                    topics.forEach(topic => {
                        const div = document.createElement('div');
                        div.className = 'topic-item';
                        const date = new Date(topic.created_at).toLocaleString('ru-RU');
                        div.innerText = `${topic.title} [${date}]`;
                        topicsList.appendChild(div);
                    });
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏ –∫–Ω–æ–ø–∫—É "–°–∫—Ä—ã—Ç—å"
                historyWrapper.style.display = "block";
                hideTopicsBtn.style.display = "block";
            } catch (err) {
                alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–º—ã");
            } finally {
                loadTopicsBtn.innerText = "–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–µ–º";
            }
        };

        // –õ–æ–≥–∏–∫–∞ —Å–∫—Ä—ã—Ç–∏—è —Å–ø–∏—Å–∫–∞
        hideTopicsBtn.onclick = () => {
            historyWrapper.style.display = "none";
            hideTopicsBtn.style.display = "none";
        };
    </script>
</body>
</html>